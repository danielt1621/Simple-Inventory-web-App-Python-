<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Inventory Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <style>
        #notificationArea {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 1000;
        }

        .notification {
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .success {
            background-color: #4CAF50;
        }

        .error {
            background-color: #f44336;
        }

        .warning {
            background-color: #ff9800;
        }
    </style>
</head>

<body class="bg-gray-100">
    <!--<div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-6">IT Inventory Management</h1>-->


        <div class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-6">
              <h1 id="it-inventory-management" class="text-3xl font-bold">IT Inventory Management</h1>
              <div class="flex space-x-2">
                <button id="exportExcel" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                  Export to Excel
                </button>
                <button id="exportPDF" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                  Export to PDF
                </button>
              </div>
            </div>



        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-2">Add Item</h2>
            <form id="addItemForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="name">
                        Name
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="name" type="text" placeholder="Item name" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="quantity">
                        Quantity
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="quantity" type="number" placeholder="Quantity" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="assignedTo">
                        Assigned To
                    </label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="assignedTo" type="text" placeholder="Assigned to" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="category">
                        Category
                    </label>
                    <select
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="category" required>
                        <option value="">Select Category</option>
                        <option value="Hardware">Hardware</option>
                        <option value="Consumables">Consumables</option>
                        <option value="Networking">Networking</option>
                        <option value="Peripherals">Peripherals</option>
                        <option value="Accessories">Accessories</option>
                    </select>
                </div>
                <div class="flex items-center justify-between">
                    <button
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                        type="submit">
                        Add Item
                    </button>
                </div>
            </form>
        </div>



        <div class="mb-6">
            <label for="categoryFilter" class="block text-gray-700 text-sm font-bold mb-2">Filter by Category</label>
            <select id="categoryFilter"
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <option value="all">All Categories</option>
                <option value="Hardware">Hardware</option>
                <option value="Consumables">Consumables</option>
                <option value="Networking">Networking</option>
                <option value="Peripherals">Peripherals</option>
                <option value="Accessories">Accessories</option>
            </select>
        </div>



        <div>
            <h2 class="text-xl font-semibold mb-2">Inventory List</h2>
            <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th class="px-4 py-2 text-left">Name</th>
                            <th class="px-4 py-2 text-left">Quantity</th>
                            <th class="px-4 py-2 text-left">Assigned To</th>
                            <th class="px-4 py-2 text-left">Category</th>
                            <th class="px-4 py-2 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryList"></tbody>
                    <tbody id="inventoryTableBody" style="display: none;"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="notificationArea"></div>

    <div id="editModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
        style="display: none;">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">Edit Item</h3>
            <form id="editItemForm">
                <input type="hidden" id="editItemId">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="editName">Name</label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="editName" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="editQuantity">Quantity</label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="editQuantity" type="number" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="editAssignedTo">Assigned To</label>
                    <input
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="editAssignedTo" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="editCategory">Category</label>
                    <select
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        id="editCategory" required>
                        <option value="Hardware">Hardware</option>
                        <option value="Consumables">Consumables</option>
                        <option value="Networking">Networking</option>
                        <option value="Peripherals">Peripherals</option>
                        <option value="Accessories">Accessories</option>
                    </select>
                </div>
                <div class="flex items-center justify-between">
                    <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Save
                        Changes</button>
                    <button type="button" onclick="closeEditModal()"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Cancel</button>
                </div>
            </form>
        </div>
    </div>



    <!-- CDN libraries included here-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>


    <script>


let inventoryData = { items: [] };

  // Fetch inventory data when the page loads
  document.addEventListener('DOMContentLoaded', function() {
    fetchInventoryData();
  });

  function fetchInventoryData() {
    fetch('/api/items')
      .then(response => response.json())
      .then(data => {
        inventoryData = data;
        renderInventoryTable();
      })
      .catch(error => console.error('Error fetching inventory data:', error));
  }

  function renderInventoryTable() {
    const tableBody = document.getElementById('inventoryTableBody');
    tableBody.innerHTML = '';
    inventoryData.items.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.quantity}</td>
        <td>${item.assignedTo}</td>
        <td>${item.category}</td>
        <td>
          <button onclick="editItem(${item.id})" class="text-blue-500 hover:text-blue-700">Edit</button>
          <button onclick="deleteItem(${item.id})" class="text-red-500 hover:text-red-700">Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }

////////////////////////////////////////////



        const addItemForm = document.getElementById('addItemForm');
        const inventoryList = document.getElementById('inventoryList');
        const editModal = document.getElementById('editModal');
        const editItemForm = document.getElementById('editItemForm');
        const notificationArea = document.getElementById('notificationArea');

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notificationArea.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        const categoryFilter = document.getElementById('categoryFilter');

        // Modify loadInventory to accept an optional filter parameter

        function loadInventory(filterCategory = 'all') {
            axios.get('/api/items')
                .then(response => {
                    inventoryList.innerHTML = '';
                    response.data.items.forEach(item => {
                        // Filter items based on category selection
                        if (filterCategory === 'all' || item.category === filterCategory) {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                        <td class="border px-4 py-2">${item.name}</td>
                        <td class="border px-4 py-2">${item.quantity}</td>
                        <td class="border px-4 py-2">${item.assignedTo}</td>
                        <td class="border px-4 py-2">${item.category}</td>
                        <td class="border px-4 py-2">
                            <button onclick="openEditModal(${item.id})" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-1 px-2 rounded mr-2">Edit</button>
                            <button onclick="deleteItem(${item.id})" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded">Delete</button>
                        </td>
                    `;
                            inventoryList.appendChild(row);

                            if (item.quantity <= 2 && item.quantity > 0) {
                                showNotification(`Low stock alert: ${item.name} (${item.quantity} left)`, 'warning');
                            } else if (item.quantity === 0) {
                                showNotification(`Out of stock: ${item.name}`, 'error');
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading inventory:', error);
                    showNotification('Error loading inventory', 'error');
                });
        }


        // Event listener to detect category changes and filter items
        categoryFilter.addEventListener('change', function () {
            const selectedCategory = categoryFilter.value;
            loadInventory(selectedCategory);
        });

        addItemForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const newItem = {
                name: document.getElementById('name').value,
                quantity: parseInt(document.getElementById('quantity').value),
                assignedTo: document.getElementById('assignedTo').value,
                category: document.getElementById('category').value
            };

            axios.post('/api/items', newItem)
                .then(response => {
                    showNotification('Item added successfully!', 'success');
                    addItemForm.reset();
                    loadInventory();
                })
                .catch(error => {
                    console.error('Error adding item:', error);
                    showNotification('Error adding item', 'error');
                });
        });

        function openEditModal(id) {
            axios.get(`/api/items/${id}`)
                .then(response => {
                    const item = response.data;
                    document.getElementById('editItemId').value = item.id;
                    document.getElementById('editName').value = item.name;
                    document.getElementById('editQuantity').value = item.quantity;
                    document.getElementById('editAssignedTo').value = item.assignedTo;
                    document.getElementById('editCategory').value = item.category;
                    editModal.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching item details:', error);
                    showNotification('Error fetching item details', 'error');
                });
        }

        function closeEditModal() {
            editModal.style.display = 'none';
        }

        editItemForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const id = document.getElementById('editItemId').value;
            const updatedItem = {
                name: document.getElementById('editName').value,
                quantity: parseInt(document.getElementById('editQuantity').value),
                assignedTo: document.getElementById('editAssignedTo').value,
                category: document.getElementById('editCategory').value
            };

            axios.put(`/api/items/${id}`, updatedItem)
                .then(response => {
                    showNotification('Item updated successfully!', 'success');
                    closeEditModal();
                    loadInventory();
                })
                .catch(error => {
                    console.error('Error updating item:', error);
                    showNotification('Error updating item', 'error');
                });
        });

        function deleteItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                axios.delete(`/api/items/${id}`)
                    .then(response => {
                        showNotification('Item deleted successfully!', 'success');
                        loadInventory();
                    })
                    .catch(error => {
                        console.error('Error deleting item:', error);
                        showNotification('Error deleting item', 'error');
                    });
            }
        }

        // Load inventory on page load
        loadInventory();





        // New functions for exporting data
        function exportToExcel() {
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.json_to_sheet(inventoryData.items.map(item => ({
      Name: item.name,
      Quantity: item.quantity,
      "Assigned To": item.assignedTo,
      Category: item.category
    })));
    XLSX.utils.book_append_sheet(wb, ws, "Inventory");
    XLSX.writeFile(wb, "inventory.xlsx");
  }

  function exportToPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.autoTable({
      head: [['Name', 'Quantity', 'Assigned To', 'Category']],
      body: inventoryData.items.map(item => [
        item.name,
        item.quantity,
        item.assignedTo,
        item.category
      ])
    });
    doc.save("inventory.pdf");
  }

  document.getElementById('exportExcel').addEventListener('click', exportToExcel);
  document.getElementById('exportPDF').addEventListener('click', exportToPDF);
    </script>
</body>

</html>